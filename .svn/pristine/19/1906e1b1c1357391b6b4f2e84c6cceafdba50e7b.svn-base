package fr.eurecom.mobserv.arianna;

import java.util.ArrayList;
import java.util.List;

import android.app.Activity;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemClickListener;
import android.widget.ArrayAdapter;
import android.widget.ListView;
import android.widget.TextView;
import android.widget.Toast;
import fr.eurecom.mobserv.arianna.model.Event;
import fr.eurecom.mobserv.arianna.model.Model;
import fr.eurecom.mobserv.arianna.model.Path;

// TODO Use a Loader in order to query the db in a different thread
//	than the main UI's one.
public class PathList extends BaseDrawerActivity {

	// TODO Try with a cursor????
	public static class PathArrayAdapter extends ArrayAdapter<Path> {
		private final List<Path> list;
		private final LayoutInflater inflater;

		public PathArrayAdapter(Activity context, List<Path> list) {
			super(context, R.layout.path_list_row_layout, list);
			this.list = list;
			this.inflater=LayoutInflater.from(context);
		}

		static class ViewHolder {
			TextView pathName;
		}

		/**
		 * Make a view to hold each row.
		 *
		 * @see android.widget.ListAdapter#getView(int, android.view.View,
		 *      android.view.ViewGroup)
		 */
		@Override
		public View getView(int position, View convertView, ViewGroup parent) {
			// A ViewHolder keeps references to children views to avoid unneccessary calls
			// to findViewById() on each row.
			ViewHolder holder;

			// When convertView is not null, we can reuse it directly, there is no need
			// to reinflate it. We only inflate a new View when the convertView supplied
			// by ListView is null.
			if (convertView == null) {

				convertView = inflater.inflate(R.layout.path_list_row_layout, null);

				// Creates a ViewHolder and store references to the two children views
				// we want to bind data to.
				holder = new ViewHolder();
				holder.pathName = (TextView) convertView.findViewById(R.id.path_name);
				convertView.setTag(holder);
			} else {
				// Get the ViewHolder back to get fast access to the TextView
				// and the ImageView.
				holder = (ViewHolder) convertView.getTag();
			}

			// Bind the data efficiently with the holder.
			holder.pathName.setText(list.get(position).getTitle());

			return convertView;
		}
	}

	public void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		ListView listView = (ListView) findViewById(R.id.path_list_view);
		Event event=(Event) Model.getByURI(Event.class, "E0", getApplicationContext());  
		List<Path> paths =new ArrayList<Path>(event.getPaths().values());
		ArrayAdapter<Path> adapter = new PathArrayAdapter(this, paths);
		listView.setAdapter(adapter);
		listView.setOnItemClickListener(new OnItemClickListener() {
			public void onItemClick(AdapterView<?> parent, View view, int position, long id) {
				// TODO Implement the startActivity
				Path item = (Path) parent.getAdapter().getItem(position);
				Toast.makeText(getApplicationContext(), item.getTitle() + " selected", Toast.LENGTH_LONG).show();
				/*
				Intent intent = new Intent(this, PathDetail.class);
				intent.putExtra(Dashboard.EXTRA_URI, item.getUri());
				 */
			}
		}); 
		//onListItemClick(new onListItemClick ListView l, View v, int position, long id) {

	}






	@Override
	public boolean onCreateOptionsMenu(Menu menu) {
		// Inflate the menu; this adds items to the action bar if it is present.
		getMenuInflater().inflate(R.menu.activity_path_list, menu);
		return true;
	}

	@Override
	protected int getContentViewResource() {
		return R.layout.activity_path_list;
	}

}

/*
	@SuppressWarnings("deprecation")
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);


		  Cursor mCursor = getContacts();
		    startManagingCursor(mCursor);
		    // Now create a new list adapter bound to the cursor.
		    // SimpleListAdapter is designed for binding to a Cursor.
		    ListAdapter adapter = new SimpleCursorAdapter(this, // Context.
		        android.R.layout.two_line_list_item, // Specify the row template
		                            // to use (here, two
		                            // columns bound to the
		                            // two retrieved cursor
		                            // rows).
		        mCursor, // Pass in the cursor to bind to.
		        // Array of cursor columns to bind to.
		        new String[] { ContactsContract.Contacts._ID,
		            ContactsContract.Contacts.DISPLAY_NAME },
		        // Parallel array of which template objects to bind to those
		        // columns.
		        new int[] { android.R.id.text1, android.R.id.text2 });

		    // Bind to our new adapter.
		    setListAdapter(adapter);
		  }

		  @SuppressWarnings("deprecation")
		private Cursor getContacts() {
		    // Run query
		    Uri uri = ContactsContract.Contacts.CONTENT_URI;
		    String[] projection = new String[] { ContactsContract.Contacts._ID,
		        ContactsContract.Contacts.DISPLAY_NAME };
		    String selection = ContactsContract.Contacts.IN_VISIBLE_GROUP + " = '"
		        + ("1") + "'";
		    String[] selectionArgs = null;
		    String sortOrder = ContactsContract.Contacts.DISPLAY_NAME
		        + " COLLATE LOCALIZED ASC";

		    return managedQuery(uri, projection, selection, selectionArgs,
		        sortOrder);
		  }

	@Override
	public boolean onCreateOptionsMenu(Menu menu) {
		// Inflate the menu; this adds items to the action bar if it is present.
		getMenuInflater().inflate(R.menu.activity_path_list, menu);
		return true;
	}

}
 */


/*
 	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		//setContentView(R.layout.activity_path_list);
		String[] values = new String[] { "Android", "iPhone", "WindowsMobile",
				"Blackberry", "WebOS", "Ubuntu", "Windows7", "Max OS X",
				"Linux", "OS/2", "Android", "iPhone", "WindowsMobile",
				"Blackberry", "WebOS", "Ubuntu", "Windows7", "Max OS X",
				"Linux", "OS/2", "Android", "iPhone", "WindowsMobile",
				"Blackberry", "WebOS", "Ubuntu", "Windows7", "Max OS X",
				"Linux", "OS/2", "Android", "iPhone", "WindowsMobile",
				"Blackberry", "WebOS", "Ubuntu", "Windows7", "Max OS X",
				"Linux", "OS/2" };
		// Use your own layout
		 ArrayAdapter<String> adapter = new ArrayAdapter<String>(this,
			        R.layout.path_list_row_layout, R.id.path_name, values);
		setListAdapter(adapter);
	}

	@Override
	protected void onListItemClick(ListView l, View v, int position, long id) {
		String item = (String) getListAdapter().getItem(position);
		Toast.makeText(this, item + " selected", Toast.LENGTH_LONG).show();
	}

	@Override
	public boolean onCreateOptionsMenu(Menu menu) {
		// Inflate the menu; this adds items to the action bar if it is present.
		getMenuInflater().inflate(R.menu.activity_path_list, menu);
		return true;
	}

}

 */